---
title: "Instart Shiny Dashboard"
output: 
  flexdashboard::flex_dashboard:
   orientation: row
   runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(janitor)
library(stringr)
library(forcats)
library(viridis)
library(plotly)
library(shiny)
```


```{r read_p1,message=FALSE}
instacart = read_csv("./data/instacart_train_data.csv.zip")
```




Column {.sidebar}
-----------------------------------------------------------------------
```{r sidebar}
department = instacart %>% distinct(department) %>% pull()

# selectInput widget
selectInput("department_choice",label = h3("Select Department"),choices = department)

max_num = (instacart %>% group_by(department, aisle) %>% count())$n %>% max()
  
# sliderInput widget
sliderInput("number_range",label = h3("Choose the number ranges"),min = 500, max = max_num,value = c(1000,300000))

```



Row
-----------------------------------------------------------------------




Row {.tabset .tabset-fade}
-----------------------------------------------------------------------
### Heatmap for number of orders in each day of week by departments
```{r}
renderPlotly({
instacart %>% 
  filter(department == input$department_choice) %>%
  mutate(order_dow = factor(order_dow),
         order_dow = fct_recode(order_dow,
                                "Monday" = "0",
                                "Tuesday" = "1",
                                "Wednesday" = "2",
                                "Thursday" = "3",
                                "Friday" = "4",
                                "Saturday" = "5",
                                "Sunday" = "6")) %>%     #recode the order_dow
  group_by(order_dow, department, aisle, aisle_id) %>% 
  count() %>% 
  mutate(order_count = n,
         text_label = str_c("aisle id:", aisle_id, "\nDepartment: ", department)) %>%
  plot_ly(x = ~aisle, y = ~order_dow, z = ~order_count, type = "heatmap", text = ~text_label)
})
```





